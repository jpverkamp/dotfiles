#!/usr/bin/env bash
set -euo pipefail

BASE_URL="https://ntfy.lan.jverkamp.com"

if [ "$#" -eq 0 ]; then
  echo "Usage: $0 [@topic] <message>"
  exit 1
fi

if [[ "$1" == @* ]]; then
  TOPIC="${1#@}"   # strip leading @
  shift            # remove topic from args
else
  TOPIC="all"
fi

MESSAGE="$*"

curl -sS -X POST -d "$MESSAGE" "$BASE_URL/$TOPIC"
